*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0d1117;--surface:#161b22;--surface2:#1c2128;
  --border:#30363d;--text:#e6edf3;--muted:#8b949e;
  --accent:#58a6ff;--green:#3fb950;--yellow:#d29922;
  --red:#f85149;--purple:#bc8cff
}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
  background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden
}

/* Focus */
:focus-visible{
  outline:2px solid var(--accent);
  outline-offset:2px
}
.card:focus-visible{
  outline-offset:-2px;
  border-color:var(--accent)
}
.toggle:focus-visible{outline-offset:-2px}
.modal input:focus-visible,.modal select:focus-visible,.modal textarea:focus-visible{
  outline-offset:-1px
}

/* Sidebar */
#sidebar{
  width:220px;min-width:220px;background:var(--surface);
  border-right:1px solid var(--border);display:flex;flex-direction:column
}
#sidebar h1{
  padding:20px;font-size:22px;font-weight:700;color:var(--accent);
  border-bottom:1px solid var(--border);letter-spacing:3px
}
.group-header{
  padding:12px 20px;font-size:12px;font-weight:600;color:var(--muted);
  text-transform:uppercase;letter-spacing:1px;cursor:pointer;
  display:flex;align-items:center;gap:6px;user-select:none
}
.group-header:hover{color:var(--text)}
.group-arrow{font-size:10px;transition:transform .15s}
.group-arrow.collapsed{transform:rotate(-90deg)}
.proj{
  padding:10px 20px 10px 34px;cursor:pointer;border-left:3px solid transparent;
  font-size:14px;transition:all .15s;display:flex;align-items:center
}
.proj:hover{background:var(--surface2)}
.proj.active{background:var(--surface2);border-left-color:var(--accent);color:var(--accent)}
.proj .proj-rm{
  margin-left:auto;opacity:0;border:none;background:none;color:var(--muted);
  cursor:pointer;font-size:12px;padding:2px 4px;border-radius:4px;transition:all .15s;flex-shrink:0
}
.proj:hover .proj-rm{opacity:1}
.proj .proj-rm:hover{color:var(--red);background:rgba(248,81,73,.1)}
#project-list{overflow-y:auto;flex:1}

/* Main layout */
#main{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* Top bar */
#topbar{
  display:none;padding:12px 24px;border-bottom:1px solid var(--border);
  background:var(--surface);align-items:center;gap:12px
}
#topbar.visible{display:flex}
#project-title{font-size:18px;font-weight:600;margin-right:8px}
.tab-group{display:flex;gap:4px}
.tab{
  padding:7px 20px;border-radius:6px;border:1px solid var(--border);
  background:transparent;color:var(--muted);font-size:14px;font-weight:500;
  cursor:pointer;font-family:inherit;transition:all .15s
}
.tab:hover{color:var(--text);border-color:var(--muted)}
.tab.active{background:var(--surface2);color:var(--accent);border-color:var(--accent)}
.topbar-sep{width:1px;height:20px;background:var(--border);align-self:center;margin:0 4px}
.btn-icon{
  width:28px;height:28px;border-radius:6px;border:1px solid var(--border);
  background:transparent;color:var(--muted);font-size:14px;cursor:pointer;
  font-family:inherit;display:flex;align-items:center;justify-content:center;
  transition:all .15s;padding:0;flex-shrink:0
}
.btn-icon:hover{color:var(--text);border-color:var(--muted)}
.btn{
  padding:6px 14px;border-radius:6px;border:1px solid var(--border);
  background:var(--surface2);color:var(--text);font-size:13px;cursor:pointer;
  font-family:inherit;transition:all .15s
}
.btn:hover{border-color:var(--accent);color:var(--accent)}
.btn-sm{padding:5px 12px;font-size:12px}
.btn-danger{color:var(--red)}
.btn-danger:hover{border-color:var(--red);background:rgba(248,81,73,.1);color:var(--red)}
.btn-primary{background:rgba(88,166,255,.15);color:var(--accent);border-color:var(--accent)}
.btn-primary:hover{background:rgba(88,166,255,.25)}
.btn-green{color:var(--green)}
.btn-green:hover{border-color:var(--green);background:rgba(63,185,80,.1)}

/* Content area */
#content{flex:1;overflow-y:auto;padding:24px}
#placeholder{
  display:flex;align-items:center;justify-content:center;
  height:100%;color:var(--muted);font-size:18px
}

/* Room grid */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:16px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden}
.card-head{padding:16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.card-name{font-size:16px;font-weight:600;flex:1;min-width:100px}
.badge{
  font-size:11px;padding:2px 8px;border-radius:10px;font-weight:500;
  text-transform:uppercase;letter-spacing:.5px;
  transition:background .2s,color .2s
}
.s-idle{background:rgba(139,148,158,.15);color:var(--muted)}
.s-working{background:rgba(88,166,255,.15);color:var(--accent)}
.s-blocked{background:rgba(210,153,34,.15);color:var(--yellow)}
.s-done{background:rgba(63,185,80,.15);color:var(--green)}
.s-exited{background:rgba(248,81,73,.15);color:var(--red)}
.s-unknown{background:rgba(139,148,158,.15);color:var(--muted)}
.model-badge{font-size:11px;padding:1px 6px;border-radius:4px;background:rgba(188,140,255,.15);color:var(--magenta,#bc8cff);font-weight:500}
.tmux{font-size:12px}
.tmux.alive{color:var(--green)}
.tmux.dead{color:var(--muted)}
.meta{padding:10px 16px;display:flex;gap:16px;font-size:13px;color:var(--muted)}
.card-actions{
  padding:8px 16px;display:flex;gap:6px;flex-wrap:wrap;
  border-top:1px solid var(--border)
}
.status-badge{
  padding:3px 8px;border-radius:6px;border:1px solid var(--border);
  background:var(--surface2);color:var(--text);font-size:12px;
  font-family:inherit;display:inline-block
}
.status-badge.ss-idle{border-color:var(--muted)}
.status-badge.ss-working{border-color:var(--accent)}
.status-badge.ss-blocked{border-color:var(--yellow)}
.status-badge.ss-done{border-color:var(--green)}
.status-badge.ss-exited{border-color:var(--red)}
.card-actions .btn-group{display:flex;gap:6px}
.card-actions .btn-sep{width:1px;background:var(--border);align-self:stretch;margin:0 4px}

/* Toggle panels */
.toggle{
  display:block;width:100%;padding:10px 16px;background:0 0;border:0;
  border-top:1px solid var(--border);color:var(--muted);font-size:13px;
  cursor:pointer;text-align:left;font-family:inherit
}
.toggle:hover{color:var(--text)}
.panel{
  display:none;padding:12px 16px;border-top:1px solid var(--border);
  font-size:13px;max-height:300px;overflow-y:auto
}
.panel.open{display:block}
.msg{padding:8px 0;border-bottom:1px solid var(--border)}
.msg:last-child{border-bottom:0}
.msg-from{font-weight:600;color:var(--accent);font-size:12px}
.msg-ts{font-size:11px;color:var(--muted);margin-left:8px}
.msg-body{margin-top:4px;line-height:1.5;white-space:pre-wrap;word-break:break-word}
.msg.unread{border-left:2px solid var(--accent);padding-left:8px}
.mol-title{font-weight:600;margin-bottom:6px;color:var(--purple)}
.mol-sep{border-color:var(--border);margin:8px 0}
.atom{padding:6px 0;display:flex;align-items:center;gap:8px}
.atom-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.atom-dot.todo{background:var(--muted)}
.atom-dot.in_progress{background:var(--accent)}
.atom-dot.done{background:var(--green)}
.empty{color:var(--muted);font-style:italic;padding:8px 0}

/* Terminal view */
#terminal-view{
  display:none;flex:1;flex-direction:column;overflow:hidden;padding:0
}
#terminal-view.active{display:flex}
#terminal-header{
  padding:10px 24px;display:flex;align-items:center;gap:12px;
  border-bottom:1px solid var(--border);background:var(--surface)
}
#terminal-header label{font-size:13px;color:var(--muted)}
#room-select{
  padding:6px 10px;border-radius:6px;border:1px solid var(--border);
  background:var(--surface2);color:var(--text);font-size:13px;font-family:inherit
}
#room-select:focus{outline:none;border-color:var(--accent)}
.conn-badge{
  font-size:11px;padding:2px 8px;border-radius:10px;font-weight:500;
  letter-spacing:.5px;transition:background .2s,color .2s
}
.conn-ws{background:rgba(63,185,80,.15);color:var(--green)}
.conn-poll{background:rgba(210,153,34,.15);color:var(--yellow)}
.conn-off{background:rgba(139,148,158,.15);color:var(--muted)}
#xterm-container{flex:1;padding:4px;overflow:hidden}
#terminal-fallback{
  flex:1;overflow:auto;padding:16px;background:#000;
  font-family:'Menlo','Monaco','Courier New',monospace;font-size:13px;
  line-height:1.4;display:none
}
#terminal-fallback.active{display:block}

/* Modal */
.modal-bg{
  position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;
  align-items:center;justify-content:center;z-index:100
}
.modal-bg.open{display:flex}
.modal{
  background:var(--surface);border:1px solid var(--border);border-radius:10px;
  padding:24px;width:400px;max-width:90vw
}
.modal h3{margin-bottom:16px;font-size:16px}
.modal label{display:block;font-size:13px;color:var(--muted);margin-bottom:4px}
.modal input,.modal select,.modal textarea{
  width:100%;padding:8px 10px;border-radius:6px;border:1px solid var(--border);
  background:var(--surface2);color:var(--text);font-size:14px;font-family:inherit;
  margin-bottom:12px
}
.modal textarea{resize:vertical;min-height:60px}
.modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}

/* Toast */
#toast-container{
  position:fixed;top:16px;right:16px;z-index:200;
  display:flex;flex-direction:column;gap:8px;pointer-events:none
}
.toast{
  padding:10px 16px;border-radius:8px;font-size:13px;
  background:var(--surface);border:1px solid var(--border);
  box-shadow:0 4px 12px rgba(0,0,0,.4);pointer-events:auto;
  animation:toast-in .3s ease;max-width:360px;
  display:flex;align-items:center;gap:10px
}
.toast-close{
  background:none;border:none;color:inherit;cursor:pointer;font-size:16px;
  padding:0 2px;line-height:1;opacity:.6
}
.toast-close:hover{opacity:1}
.toast.success{border-color:var(--green);color:var(--green)}
.toast.error{border-color:var(--red);color:var(--red)}
.toast.info{border-color:var(--accent);color:var(--accent)}
@keyframes toast-in{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:none}}

/* Keyboard help overlay */
#keyboard-help{
  position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;
  align-items:center;justify-content:center;z-index:150
}
#keyboard-help.open{display:flex}
#keyboard-help .help-panel{
  background:var(--surface);border:1px solid var(--border);border-radius:10px;
  padding:24px 28px;width:420px;max-width:90vw;max-height:80vh;overflow-y:auto
}
#keyboard-help h3{margin-bottom:16px;font-size:16px;color:var(--accent)}
#keyboard-help table{width:100%;border-collapse:collapse;font-size:13px}
#keyboard-help td{padding:5px 0}
#keyboard-help td:first-child{
  color:var(--text);font-family:'Menlo','Monaco',monospace;font-size:12px;
  white-space:nowrap;width:100px
}
#keyboard-help td:last-child{color:var(--muted)}
#keyboard-help .help-section{
  font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;
  padding:12px 0 4px;border-bottom:1px solid var(--border);margin-bottom:4px
}

/* Loading dot */
.dot{
  position:fixed;top:12px;right:12px;width:8px;height:8px;border-radius:50%;
  background:var(--green);opacity:.5;transition:opacity .3s;z-index:300
}
.dot.loading{opacity:1;background:var(--accent)}
