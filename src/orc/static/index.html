<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>orc</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/css/xterm.css">
<link rel="stylesheet" href="/static/styles.css">
</head>
<body>

<nav id="sidebar">
  <h1>orc</h1>
  <div id="project-list"></div>
</nav>

<div id="main">
  <div id="topbar">
    <span id="project-title"></span>
    <div class="tab-group">
      <button class="tab active" data-tab="overview" onclick="switchTab('overview')">Overview</button>
      <button class="tab" data-tab="terminal" onclick="switchTab('terminal')">Terminal</button>
    </div>
    <div class="topbar-sep"></div>
    <button class="btn btn-sm" onclick="doClean()">Clean</button>
    <button class="btn btn-sm" onclick="showAddRoom()">+ Add Room</button>
    <div style="flex:1"></div>
    <button class="btn-icon" onclick="toggleHelp()" title="Keyboard shortcuts (?)">?</button>
    <button class="btn btn-sm btn-danger" onclick="doShutdown()" title="Stop sandbox">Shutdown</button>
  </div>

  <div id="content">
    <div id="placeholder">Select a project</div>
    <div id="rooms" class="grid" role="list" style="display:none"></div>
  </div>

  <div id="terminal-view">
    <div id="terminal-header">
      <label>Room:</label>
      <select id="room-select" onchange="termSelectRoom()"></select>
      <span id="conn-indicator" class="conn-badge conn-off">--</span>
      <div style="flex:1"></div>
      <button class="btn btn-sm" onclick="switchTab('overview')">Back to Overview</button>
    </div>
    <div id="xterm-container"></div>
    <div id="terminal-fallback"></div>
  </div>
</div>

<!-- Add Room Modal -->
<div class="modal-bg" id="modal-add">
  <div class="modal">
    <h3>Add Room</h3>
    <label>Room name</label>
    <input id="add-room-name" placeholder="e.g. worker-2">
    <label>Role</label>
    <select id="add-room-role">
      <option value="worker">worker</option>
      <option value="orchestrator">orchestrator</option>
      <option value="merger">merger</option>
    </select>
    <label>Initial message (optional)</label>
    <textarea id="add-room-message" placeholder="Message to send on launch..."></textarea>
    <div class="modal-actions">
      <button class="btn" onclick="hideAddRoom()">Cancel</button>
      <button class="btn" onclick="doAddRoom()">Add</button>
      <button class="btn btn-primary" onclick="doAddRoom(true)">Add &amp; Launch</button>
    </div>
  </div>
</div>

<!-- Tell Modal -->
<div class="modal-bg" id="modal-tell">
  <div class="modal">
    <h3>Tell <span id="tell-room-name"></span></h3>
    <label>Message to send to session</label>
    <textarea id="tell-message" placeholder="Type your message..."></textarea>
    <div class="modal-actions">
      <button class="btn" onclick="hideTell()">Cancel</button>
      <button class="btn btn-primary" onclick="doTell()">Send</button>
    </div>
  </div>
</div>

<!-- Send Inbox Message Modal -->
<div class="modal-bg" id="modal-send">
  <div class="modal">
    <h3>Send message to <span id="send-room-name"></span></h3>
    <label>From</label>
    <input id="send-from" placeholder="e.g. @main" value="@main">
    <label>Message</label>
    <textarea id="send-message" placeholder="Inbox message..."></textarea>
    <div class="modal-actions">
      <button class="btn" onclick="hideSend()">Cancel</button>
      <button class="btn btn-primary" onclick="doSend()">Send</button>
    </div>
  </div>
</div>

<!-- Add Project Modal -->
<div class="modal-bg" id="modal-add-project">
  <div class="modal">
    <h3>Add Project</h3>
    <label>Git URL <span style="color:var(--red)">*</span></label>
    <input id="add-project-url" placeholder="https://github.com/user/repo.git">
    <label>Name (optional, defaults to repo name)</label>
    <input id="add-project-name" placeholder="e.g. my-project">
    <div class="modal-actions">
      <button class="btn" onclick="hideAddProject()">Cancel</button>
      <button class="btn btn-primary" onclick="doAddProject()">Clone</button>
    </div>
  </div>
</div>

<!-- Keyboard Help Overlay -->
<div id="keyboard-help">
  <div class="help-panel">
    <h3>Keyboard Shortcuts</h3>
    <div class="help-section">Global</div>
    <table>
      <tr><td>1</td><td>Overview tab</td></tr>
      <tr><td>2</td><td>Terminal tab</td></tr>
      <tr><td>j / &darr;</td><td>Next room card</td></tr>
      <tr><td>k / &uarr;</td><td>Previous room card</td></tr>
      <tr><td>Enter</td><td>Open terminal for focused card</td></tr>
      <tr><td>p</td><td>Add project</td></tr>
      <tr><td>Escape</td><td>Close modal / help</td></tr>
      <tr><td>?</td><td>Toggle this help</td></tr>
    </table>
    <div class="help-section">Card focused</div>
    <table>
      <tr><td>t</td><td>Open terminal</td></tr>
      <tr><td>m</td><td>Send inbox message</td></tr>
    </table>
  </div>
</div>

<div id="toast-container"></div>
<div class="dot" id="dot"></div>

<script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@5.5.0/lib/xterm.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.10.0/lib/addon-fit.js"></script>
<script src="https://cdn.jsdelivr.net/npm/ansi_up@6.0.2/ansi_up.min.js"></script>
<script src="/static/app.js"></script>
</body>
</html>
